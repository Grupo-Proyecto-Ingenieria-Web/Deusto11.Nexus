{% extends "base.html" %} 
{% load static %}
{% block tittle %}{{ tittle }}{% endblock %}
{% block content %}
<div id="todo">
    <div id="argum2"> 
        <a href="{% url 'menu_default_portal' %}"><input class="personalizar" type="submit" value="Volver al inicio" /></a>   
<h1 id="title2">NUEVO TICKET</h1>
<p>Rellena el siguiente formulario para a√±adir un nuevo ticket:</p>
  
    <legend>Datos del ticket</legend>
    <br>
    <div>
        <script>
            document.getElementsByName("personalizar")[0].addEventListener("submit", Crearobj)
                function Crearobj(event) {
                event.preventDefault()
                var n_referencia = document.getElementById('n_referencia').value;
                var titulo = document.getElementById('titulo').val();
                var estadp = document.getElementById('estado').val();
                var esto=new FormData(document.getElementById("formu"))
                fetch("http://127.0.0.1:8000/nexus.com/apialltickets/", {
                method :'POST',

                body :
                esto
                    })
                .then(response => response.json())
                .then(json => console.log(json))
                var p=document.getElementById('exito')
                var text = document.createTextNode("Se ha creado el cliente correctamente");

            p.appendChild(text);
    }
            
        </script>
    </div>
        <br>
        <div>
            <form action="{% url 'ticket_registry' %}" method="post">
                {% csrf_token %}
                Numero de referencia:<input type="text" name="reference_number">
                <br><br>
                <!--Nombre completo del empleado:<input type="text" name="">
                 <br><br> -->
                Titulo:
                <input id="titulo" type="text" name="title">
                <br><br> 
                Estado:<select id="estado" name="estado" name="status">
                    <option selected>Abierto</option>
                    <option>Cerrado</option>
                </select>
                <br><br> 
                Tipo:<select id="tipo" name="tipo" name="ticket_type">
                    <option>Averia</option>
                    <option selected>Mejora</option>
                    <option>Mantenimiento</option>
                </select>
                <br><br> 
                Nivel de urgencia:<select id="urgencia" name="urgency_level">
                        <option selected>Urgente</option>
                        <option>Alta</option>
                        <option>Media</option>
                        <option>Baja</option>
                    </select>
                <br><br>
                <p>Selecciona la fecha de apertura: </p>
                <label for="fecha">
                        <input type="date" id="fechaa" name="starting_date" />
                    </label>
                <p>Selecciona la fecha de resolucion: </p>
                <label for="fecha">
                        <input type="date" id="fechad" name="resolution_date" />
                    </label>
                <br><br>
                <label for="comentario">Comentarios
                        <input type="placeholder" id="comentario" name="comment" />
                    </label>
                <br><br>
                <label for="comentario">Descripcion corta
                        <input type="placeholder" id="descripcion" name="description" />
                    </label>
                <br><br>
                <input class="personalizar" type="submit" value="Registrar ticket" />
                <br><br>
                <!--<input class="personalizar" type="submit" value="Actualizar maquina" />-->
                {% if list_machines_already_exists %}  
                    {% for machine in list_machines_already_exists %}
                    <br><br> Selecciona maquina:
                        <select id="urgencia" name="urgencia">
                            <option selected>Seleccionar</option>
                            <option>{{ machine }}</option>
                        </select>
                    <br><br>
                    <input class="personalizar" type="submit" value="Registrar ticket" />
                {% endfor %}
            </form>
        </div>
    </div>
</div>
{% endblock %}